@using Trackmeal.Models
@model Order
@{
    Layout = "_Layout";
    ViewData["Title"] = $"Details of order with ID {Model.Id}";
}

 <h2>@ViewData["Title"]</h2>
<div data-order-id="@Model.Id">
    @Html.ActionLink("Back to orders", "Index", new { }, new { @class = "btn btn-primary" })
    <button class="btn btn-danger" id="delete-button" data-order-id="@Model.Id">Delete order</button>

    @await Html.PartialAsync("Order/_OrderDetails", Model)

    <h4>Current status: <span id="status-name">@Model.OrderStatus.Name</span></h4>
    <button class="btn btn-danger" id="prev-state-btn"
            disabled="@(Model.OrderStatusId <= (byte)OrderStatusEnum.Submitted)">Previous state</button>
    <button class="btn btn-primary" id="next-state-btn"
            disabled="@(Model.OrderStatusId >= (byte)OrderStatusEnum.Completed)">Next state</button>
    
    <input type="hidden" id="order-id-input" value="@Model.Id"/>
    <input type="hidden" id="order-status-id-input" value="@Model.OrderStatusId"/>
</div>

@section Scripts
{
    <script>
        $(document).ready(function() {
            $("#delete-button").on("click",
                function() {
                    if (confirm("Are you sure you want to delete this order?")) {
                        $.ajax({
                            url: `/api/order/${$(this).parent().attr("data-order-id")}`,
                            method: "DELETE",
                            success: function() {
                                window.location.href = '@Url.Action("Index")';
                            }
                        });
                    }
                }
            );
        });
    </script>
    <script src="~/lib/signalr/dist/browser/signalr.min.js"></script>
    <script src="~/js/orderStatus.js"></script>
}
